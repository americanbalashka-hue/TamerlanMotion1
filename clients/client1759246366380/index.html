<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AR Фото-видео</title>
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
body {
  margin: 0;
  background: black;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
#container {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: black;
}
#startButton {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  padding: 18px 40px;
  font-size: 20px;
  font-weight: bold;
  background: #ff9900;
  color: #ffffff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 10;
  transition: 0.2s;
}
#startButton:hover {
  background: #e68a00;
}
a-scene {
  width: 100%; height: 100%;
}
</style>
</head>
<body>
<div id="container">
  <button id="startButton">Нажмите, чтобы включить</button>

  <a-scene mindar-image="imageTargetSrc: targets.mind;" embedded color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <video id="video1" src="ssstik.io_@crrrcho_1758636641890.mp4" preload="auto" playsinline webkit-playsinline muted></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0" id="targetEntity">
      <a-video id="videoPlane" src="#video1" material="opacity: 0.65"></a-video>
    </a-entity>

  </a-scene>
</div>

<script>
const button = document.getElementById('startButton');
const videoEl = document.getElementById('video1');
const videoPlane = document.getElementById('videoPlane');
const targetEntity = document.getElementById('targetEntity');
let isPlaying = false;

// Кнопка запуска камеры
button.addEventListener('click', async () => {
  try {
    videoEl.muted = true;
    await videoEl.play();
    videoEl.pause();
    videoEl.currentTime = 0;
    button.style.display = 'none';
  } catch(err) {
    console.error(err);
    alert('Не удалось включить камеру');
  }
});

// Автоподстройка видео под размеры цели
targetEntity.addEventListener('targetFound', () => {
  const targetComp = targetEntity.components['mindar-image-target'];
  if(targetComp && targetComp.el.object3D.children[0]){
    const targetObj = targetComp.el.object3D.children[0];

    // Получаем реальные размеры цели через BoundingBox
    const bbox = new THREE.Box3().setFromObject(targetObj);
    const size = new THREE.Vector3();
    bbox.getSize(size);

    videoPlane.setAttribute('width', size.x);
    videoPlane.setAttribute('height', size.y);
  }

  if(!isPlaying){
    videoEl.muted = false;
    videoEl.currentTime = 0;
    videoEl.play();
    isPlaying = true;
  }
});

targetEntity.addEventListener('targetLost', () => {
  videoEl.pause();
  videoEl.currentTime = 0;
  isPlaying = false;
});
</script>
</body>
</html>